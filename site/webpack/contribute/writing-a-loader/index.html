<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="demun blog"><link rel="canonical" href="https://demun.github.io/webpack/contribute/writing-a-loader/"><meta name="author" content="demun"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="../../../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>Writing a Loader</title><link rel="stylesheet" href="../../../assets/stylesheets/application.4031d38b.css"><link rel="stylesheet" href="../../../assets/stylesheets/application-palette.224b79ff.css"><meta name="theme-color" content="#3f51b5"><script src="../../../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=맑은고딕:300,400,400i,700|맑은고딕&display=swap"><style>body,input{font-family:"맑은고딕","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"맑은고딕","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../../../assets/fonts/material-icons.css"><link rel="stylesheet" href="../../../assets/stylesheets/extra.css"><script>window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-XXXXXXXX-X", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })</script><script async src="https://www.google-analytics.com/analytics.js"></script></head><body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo"><svg class="md-svg"><defs><svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#setup" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="https://demun.github.io/" title="demun.github.io" class="md-header-nav__button md-logo"><i class="md-icon"></i></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">demun.github.io</span><span class="md-header-nav__topic">Writing a Loader</span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">Type to start searching</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div><div class="md-flex__cell md-flex__cell--shrink"><div class="md-header-nav__source"><a href="https://github.com/demun/demun.github.io" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">demun/demun.github.io</div></a></div></div></div></nav></header><div class="md-container"><nav class="md-tabs" data-md-component="tabs"><div class="md-tabs__inner md-grid"><ul class="md-tabs__list"><li class="md-tabs__item"><a href="../../.." title="Home" class="md-tabs__link md-tabs__link--active">Home</a></li><li class="md-tabs__item"><a href="../../../publisher-report/" title="Publisher report" class="md-tabs__link">Publisher report</a></li><li class="md-tabs__item"><a href="../../../vscode/" title="Visual Studio Code" class="md-tabs__link">Visual Studio Code</a></li><li class="md-tabs__item"><a href="../../../mkdocs/" title="MkDocs" class="md-tabs__link">MkDocs</a></li><li class="md-tabs__item"><a href="../../../material-theme/" title="MkDocs Material" class="md-tabs__link">MkDocs Material</a></li><li class="md-tabs__item"><a href="../../guides/getting-started/" title="Webpack" class="md-tabs__link">Webpack</a></li></ul></div></nav><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="https://demun.github.io/" title="demun.github.io" class="md-nav__button md-logo"><i class="md-icon"></i></a>demun.github.io</label><div class="md-nav__source"><a href="https://github.com/demun/demun.github.io" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">demun/demun.github.io</div></a></div><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../.." title="Home" class="md-nav__link">Home</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2"><label class="md-nav__link" for="nav-2">Publisher report</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-2">Publisher report</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../../publisher-report/" title="HTML소개" class="md-nav__link">HTML소개</a></li><li class="md-nav__item"><a href="../../../publisher-report/00_default/" title="HTML기본" class="md-nav__link">HTML기본</a></li><li class="md-nav__item"><a href="../../../publisher-report/01_html/" title="HTML만들기" class="md-nav__link">HTML만들기</a></li><li class="md-nav__item"><a href="../../../publisher-report/02_p/" title="단락,블럭,주석" class="md-nav__link">단락,블럭,주석</a></li><li class="md-nav__item"><a href="../../../publisher-report/03_a/" title="링크,이미지" class="md-nav__link">링크,이미지</a></li><li class="md-nav__item"><a href="../../../publisher-report/04_list/" title="리스트" class="md-nav__link">리스트</a></li><li class="md-nav__item"><a href="../../../publisher-report/05_table/" title="표" class="md-nav__link">표</a></li><li class="md-nav__item"><a href="../../../publisher-report/06_html5/" title="HTML5" class="md-nav__link">HTML5</a></li><li class="md-nav__item"><a href="../../../publisher-report/07_css/" title="CSS소개" class="md-nav__link">CSS소개</a></li><li class="md-nav__item"><a href="../../../publisher-report/08_color/" title="색상,배경,테두리" class="md-nav__link">색상,배경,테두리</a></li><li class="md-nav__item"><a href="../../../publisher-report/09_padding/" title="여백,높이" class="md-nav__link">여백,높이</a></li><li class="md-nav__item"><a href="../../../publisher-report/10_box/" title="박스모델" class="md-nav__link">박스모델</a></li><li class="md-nav__item"><a href="../../../publisher-report/11_text/" title="텍스트" class="md-nav__link">텍스트</a></li><li class="md-nav__item"><a href="../../../publisher-report/12_list/" title="목록,표" class="md-nav__link">목록,표</a></li><li class="md-nav__item"><a href="../../../publisher-report/13_display/" title="디스플레이" class="md-nav__link">디스플레이</a></li><li class="md-nav__item"><a href="../../../publisher-report/14_overflow/" title="오버플로우" class="md-nav__link">오버플로우</a></li><li class="md-nav__item"><a href="../../../publisher-report/15_radius/" title="둥근테두리" class="md-nav__link">둥근테두리</a></li><li class="md-nav__item"><a href="../../../publisher-report/16_gradient/" title="그라디언트" class="md-nav__link">그라디언트</a></li><li class="md-nav__item"><a href="../../../publisher-report/17_text/" title="텍스트효과" class="md-nav__link">텍스트효과</a></li><li class="md-nav__item"><a href="../../../publisher-report/18_shadow/" title="그림자" class="md-nav__link">그림자</a></li><li class="md-nav__item"><a href="../../../publisher-report/19_webfont/" title="웹글꼴" class="md-nav__link">웹글꼴</a></li><li class="md-nav__item"><a href="../../../publisher-report/20_viewport/" title="뷰포트" class="md-nav__link">뷰포트</a></li><li class="md-nav__item"><a href="../../../publisher-report/21_fixed/" title="레이아웃 고정형" class="md-nav__link">레이아웃 고정형</a></li><li class="md-nav__item"><a href="../../../publisher-report/22_flow/" title="레이아웃 유동형" class="md-nav__link">레이아웃 유동형</a></li><li class="md-nav__item"><a href="../../../publisher-report/23_response/" title="레이아웃 반응형" class="md-nav__link">레이아웃 반응형</a></li><li class="md-nav__item"><a href="../../../publisher-report/24_exam/" title="호환성 보기 설정" class="md-nav__link">호환성 보기 설정</a></li><li class="md-nav__item"><a href="../../../publisher-report/25_exam/" title="개발자 도구 확인" class="md-nav__link">개발자 도구 확인</a></li><li class="md-nav__item"><a href="../../../publisher-report/26_exam/" title="QR코드 생성" class="md-nav__link">QR코드 생성</a></li><li class="md-nav__item"><a href="../../../publisher-report/27_exam/" title="모바일 검수" class="md-nav__link">모바일 검수</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3"><label class="md-nav__link" for="nav-3">Visual Studio Code</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-3">Visual Studio Code</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../../vscode/" title="소개" class="md-nav__link">소개</a></li><li class="md-nav__item"><a href="../../../vscode/shortcuts/" title="단축키" class="md-nav__link">단축키</a></li><li class="md-nav__item"><a href="../../../vscode/git/" title="Git" class="md-nav__link">Git</a></li><li class="md-nav__item"><a href="../../../vscode/debug/" title="Debug" class="md-nav__link">Debug</a></li><li class="md-nav__item"><a href="../../../vscode/task/" title="Task" class="md-nav__link">Task</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4"><label class="md-nav__link" for="nav-4">MkDocs</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-4">MkDocs</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../../mkdocs/" title="소개" class="md-nav__link">소개</a></li><li class="md-nav__item"><a href="../../../mkdocs/how/" title="사용법" class="md-nav__link">사용법</a></li><li class="md-nav__item"><a href="../../../mkdocs/theme/" title="테마" class="md-nav__link">테마</a></li><li class="md-nav__item"><a href="../../../mkdocs/tree/" title="구조" class="md-nav__link">구조</a></li><li class="md-nav__item"><a href="../../../mkdocs/others/" title="기타" class="md-nav__link">기타</a></li><li class="md-nav__item"><a href="../../../mkdocs/admonition/" title="Admonition" class="md-nav__link">Admonition</a></li><li class="md-nav__item"><a href="../../../mkdocs/publish/" title="배포" class="md-nav__link">배포</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5"><label class="md-nav__link" for="nav-5">MkDocs Material</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-5">MkDocs Material</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../../material-theme/" title="Material" class="md-nav__link">Material</a></li><li class="md-nav__item"><a href="../../../material-theme/getting-started/" title="Getting started" class="md-nav__link">Getting started</a></li><li class="md-nav__item"><a href="../../../material-theme/specimen/" title="Specimen" class="md-nav__link">Specimen</a></li><li class="md-nav__item"><a href="../../../material-theme/customization/" title="Customization" class="md-nav__link">Customization</a></li><li class="md-nav__item"><a href="../../../material-theme/compliance/" title="Compliance with GDPR" class="md-nav__link">Compliance with GDPR</a></li><li class="md-nav__item"><a href="../../../material-theme/extensions/admonition/" title="Admonition" class="md-nav__link">Admonition</a></li><li class="md-nav__item"><a href="../../../material-theme/extensions/codehilite/" title="CodeHilite" class="md-nav__link">CodeHilite</a></li><li class="md-nav__item"><a href="../../../material-theme/extensions/footnotes/" title="Footnotes" class="md-nav__link">Footnotes</a></li><li class="md-nav__item"><a href="../../../material-theme/extensions/metadata/" title="Metadata" class="md-nav__link">Metadata</a></li><li class="md-nav__item"><a href="../../../material-theme/extensions/permalinks/" title="Permalinks" class="md-nav__link">Permalinks</a></li><li class="md-nav__item"><a href="../../../material-theme/extensions/pymdown/" title="PyMdown" class="md-nav__link">PyMdown</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6"><label class="md-nav__link" for="nav-6">Webpack</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-6">Webpack</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../guides/getting-started/" title="Getting Started" class="md-nav__link">Getting Started</a></li><li class="md-nav__item"><a href="../../guides/asset-management/" title="Asset Management" class="md-nav__link">Asset Management</a></li><li class="md-nav__item"><a href="../../guides/development/" title="Development" class="md-nav__link">Development</a></li><li class="md-nav__item"><a href="../../guides/code-splitting/" title="Code Spliting" class="md-nav__link">Code Spliting</a></li><li class="md-nav__item"><a href="../../guides/caching/" title="Caching" class="md-nav__link">Caching</a></li><li class="md-nav__item"><a href="../../guides/author-libraries/" title="Authoring Libraries" class="md-nav__link">Authoring Libraries</a></li><li class="md-nav__item"><a href="../../guides/environment-variables/" title="Environment Variables" class="md-nav__link">Environment Variables</a></li><li class="md-nav__item"><a href="../../guides/build-performance/" title="Build Performance" class="md-nav__link">Build Performance</a></li><li class="md-nav__item"><a href="../../guides/csp/" title="Content Security Policies" class="md-nav__link">Content Security Policies</a></li><li class="md-nav__item"><a href="../../guides/development-vagrant/" title="Development - Vagrant" class="md-nav__link">Development - Vagrant</a></li><li class="md-nav__item"><a href="../../guides/installation/" title="Installation" class="md-nav__link">Installation</a></li><li class="md-nav__item"><a href="../../guides/scaffolding/" title="Scaffolding" class="md-nav__link">Scaffolding</a></li><li class="md-nav__item"><a href="../../guides/output-management/" title="Output Management" class="md-nav__link">Output Management</a></li><li class="md-nav__item"><a href="../../guides/hot-module-replacement/" title="Hot Module Replacement" class="md-nav__link">Hot Module Replacement</a></li><li class="md-nav__item"><a href="../../guides/tree-shaking/" title="Tree Shaking" class="md-nav__link">Tree Shaking</a></li><li class="md-nav__item"><a href="../../guides/production/" title="Production" class="md-nav__link">Production</a></li><li class="md-nav__item"><a href="../../guides/lazy-loading/" title="Lazy Loading" class="md-nav__link">Lazy Loading</a></li><li class="md-nav__item"><a href="../../guides/shimming/" title="Shimming" class="md-nav__link">Shimming</a></li><li class="md-nav__item"><a href="../../guides/typescript/" title="TypeScript" class="md-nav__link">TypeScript</a></li><li class="md-nav__item"><a href="../../guides/progressive-web-application/" title="Progressive Web Application" class="md-nav__link">Progressive Web Application</a></li><li class="md-nav__item"><a href="../../guides/public-path/" title="Public Path" class="md-nav__link">Public Path</a></li><li class="md-nav__item"><a href="../../guides/integrations/" title="Integrations" class="md-nav__link">Integrations</a></li><li class="md-nav__item"><a href="../../concepts/" title="Concepts" class="md-nav__link">Concepts</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#setup" title="Setup" class="md-nav__link">Setup</a></li><li class="md-nav__item"><a href="#simple-usage" title="Simple Usage" class="md-nav__link">Simple Usage</a></li><li class="md-nav__item"><a href="#complex-usage" title="Complex Usage" class="md-nav__link">Complex Usage</a></li><li class="md-nav__item"><a href="#guidelines" title="Guidelines" class="md-nav__link">Guidelines</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#simple" title="Simple" class="md-nav__link">Simple</a></li><li class="md-nav__item"><a href="#chaining" title="Chaining" class="md-nav__link">Chaining</a></li><li class="md-nav__item"><a href="#modular" title="Modular" class="md-nav__link">Modular</a></li><li class="md-nav__item"><a href="#stateless" title="Stateless" class="md-nav__link">Stateless</a></li><li class="md-nav__item"><a href="#loader-utilities" title="Loader Utilities" class="md-nav__link">Loader Utilities</a></li><li class="md-nav__item"><a href="#loader-dependencies" title="Loader Dependencies" class="md-nav__link">Loader Dependencies</a></li><li class="md-nav__item"><a href="#module-dependencies" title="Module Dependencies" class="md-nav__link">Module Dependencies</a></li><li class="md-nav__item"><a href="#common-code" title="Common Code" class="md-nav__link">Common Code</a></li><li class="md-nav__item"><a href="#absolute-paths" title="Absolute Paths" class="md-nav__link">Absolute Paths</a></li><li class="md-nav__item"><a href="#peer-dependencies" title="Peer Dependencies" class="md-nav__link">Peer Dependencies</a></li></ul></nav></li><li class="md-nav__item"><a href="#testing" title="Testing" class="md-nav__link">Testing</a></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><h1>Writing a Loader</h1><p>A loader is a node module that exports a function. This function is called when a resource should be transformed by this loader. The given function will have access to the <a href="/api/loaders/">Loader API</a> using the <code>this</code> context provided to it.</p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<p>Before we dig into the different types of loaders, their usage, and examples, let's take a look at the three ways you can develop and test a loader locally.</p>
<p>To test a single loader, you can simply use <code>path</code> to <code>resolve</code> a local file within a rule object:</p>
<p><strong>webpack.config.js</strong></p>
<div class="codehilite"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">//...</span>
  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nx">loader</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;path/to/loader.js&#39;</span><span class="p">),</span>
            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span><span class="cm">/* ... */</span><span class="p">}</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>

<p>To test multiple, you can utilize the <code>resolveLoader.modules</code> configuration to update where webpack will search for loaders. For example, if you had a local <code>/loaders</code> directory in your project:</p>
<p><strong>webpack.config.js</strong></p>
<div class="codehilite"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">//...</span>
  <span class="nx">resolveLoader</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span>
      <span class="s1">&#39;node_modules&#39;</span><span class="p">,</span>
      <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;loaders&#39;</span><span class="p">)</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>

<p>Last but not least, if you've already created a separate repository and package for your loader, you could <a href="https://docs.npmjs.com/cli/link"><code>npm link</code></a> it to the project in which you'd like to test it out.</p>
<h2 id="simple-usage">Simple Usage<a class="headerlink" href="#simple-usage" title="Permanent link">&para;</a></h2>
<p>When a single loader is applied to the resource, the loader is called with only one parameter -- a string containing the content of the resource file.</p>
<p>Synchronous loaders can simply <code>return</code> a single value representing the transformed module. In more complex cases, the loader can return any number of values by using the <code>this.callback(err, values...)</code> function. Errors are either passed to the <code>this.callback</code> function or thrown in a sync loader.</p>
<p>The loader is expected to give back one or two values. The first value is a resulting JavaScript code as string or buffer. The second optional value is a SourceMap as JavaScript object.</p>
<h2 id="complex-usage">Complex Usage<a class="headerlink" href="#complex-usage" title="Permanent link">&para;</a></h2>
<p>When multiple loaders are chained, it is important to remember that they are executed in reverse order -- either right to left or bottom to top depending on array format.</p>
<ul>
<li>The last loader, called first, will be passed the contents of the raw resource.</li>
<li>The first loader, called last, is expected to return JavaScript and an optional source map.</li>
<li>The loaders in between will be executed with the result(s) of the previous loader in the chain.</li>
</ul>
<p>So, in the following example, the <code>foo-loader</code> would be passed the raw resource and the <code>bar-loader</code> would receive the output of the <code>foo-loader</code> and return the final transformed module and a source map if necessary.</p>
<p><strong>webpack.config.js</strong></p>
<div class="codehilite"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">//...</span>
  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js/</span><span class="p">,</span>
        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
          <span class="s1">&#39;bar-loader&#39;</span><span class="p">,</span>
          <span class="s1">&#39;foo-loader&#39;</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>

<h2 id="guidelines">Guidelines<a class="headerlink" href="#guidelines" title="Permanent link">&para;</a></h2>
<p>The following guidelines should be followed when writing a loader. They are ordered in terms of importance and some only apply in certain scenarios, read the detailed sections that follow for more information.</p>
<ul>
<li>Keep them <strong>simple</strong>.</li>
<li>Utilize <strong>chaining</strong>.</li>
<li>Emit <strong>modular</strong> output.</li>
<li>Make sure they're <strong>stateless</strong>.</li>
<li>Employ <strong>loader utilities</strong>.</li>
<li>Mark <strong>loader dependencies</strong>.</li>
<li>Resolve <strong>module dependencies</strong>.</li>
<li>Extract <strong>common code</strong>.</li>
<li>Avoid <strong>absolute paths</strong>.</li>
<li>Use <strong>peer dependencies</strong>.</li>
</ul>
<h3 id="simple">Simple<a class="headerlink" href="#simple" title="Permanent link">&para;</a></h3>
<p>Loaders should do only a single task. This not only makes the job of maintaining each loader easier, but also allows them to be chained for usage in more scenarios.</p>
<h3 id="chaining">Chaining<a class="headerlink" href="#chaining" title="Permanent link">&para;</a></h3>
<p>Take advantage of the fact that loaders can be chained together. Instead of writing a single loader that tackles five tasks, write five simpler loaders that divide this effort. Isolating them not only keeps each individual loader simple, but may allow for them to be used for something you hadn't thought of originally.</p>
<p>Take the case of rendering a template file with data specified via loader options or query parameters. It could be written as a single loader that compiles the template from source, executes it and returns a module that exports a string containing the HTML code. However, in accordance with guidelines, a simple <code>apply-loader</code> exists that can be chained with other open source loaders:</p>
<ul>
<li><code>jade-loader</code>: Convert template to a module that exports a function.</li>
<li><code>apply-loader</code>: Executes the function with loader options and returns raw HTML.</li>
<li><code>html-loader</code>: Accepts HTML and outputs a valid JavaScript module.</li>
</ul>
<p>T&gt; The fact that loaders can be chained also means they don't necessarily have to output JavaScript. As long as the next loader in the chain can handle its output, the loader can return any type of module.</p>
<h3 id="modular">Modular<a class="headerlink" href="#modular" title="Permanent link">&para;</a></h3>
<p>Keep the output modular. Loader generated modules should respect the same design principles as normal modules.</p>
<h3 id="stateless">Stateless<a class="headerlink" href="#stateless" title="Permanent link">&para;</a></h3>
<p>Make sure the loader does not retain state between module transformations. Each run should always be independent of other compiled modules as well as previous compilations of the same module.</p>
<h3 id="loader-utilities">Loader Utilities<a class="headerlink" href="#loader-utilities" title="Permanent link">&para;</a></h3>
<p>Take advantage of the <a href="https://github.com/webpack/loader-utils"><code>loader-utils</code></a> package. It provides a variety of useful tools but one of the most common is retrieving the options passed to the loader. Along with <code>loader-utils</code>, the <a href="https://github.com/webpack-contrib/schema-utils"><code>schema-utils</code></a> package should be used for consistent JSON Schema based validation of loader options. Here's a brief example that utilizes both:</p>
<p><strong>loader.js</strong></p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">getOptions</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;loader-utils&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">validateOptions</span> <span class="nx">from</span> <span class="s1">&#39;schema-utils&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">schema</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
  <span class="nx">properties</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">test</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;string&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">getOptions</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="nx">validateOptions</span><span class="p">(</span><span class="nx">schema</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="s1">&#39;Example Loader&#39;</span><span class="p">);</span>

  <span class="c1">// Apply some transformations to the source...</span>

  <span class="k">return</span> <span class="sb">`export default </span><span class="si">${</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h3 id="loader-dependencies">Loader Dependencies<a class="headerlink" href="#loader-dependencies" title="Permanent link">&para;</a></h3>
<p>If a loader uses external resources (i.e. by reading from filesystem), they <strong>must</strong> indicate it. This information is used to invalidate cacheable loaders and recompile in watch mode. Here's a brief example of how to accomplish this using the <code>addDependency</code> method:</p>
<p><strong>loader.js</strong></p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">path</span> <span class="nx">from</span> <span class="s1">&#39;path&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">async</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">headerPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;header.js&#39;</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">addDependency</span><span class="p">(</span><span class="nx">headerPath</span><span class="p">);</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">headerPath</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">header</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">header</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="nx">source</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<h3 id="module-dependencies">Module Dependencies<a class="headerlink" href="#module-dependencies" title="Permanent link">&para;</a></h3>
<p>Depending on the type of module, there may be a different schema used to specify dependencies. In CSS for example, the <code>@import</code> and <code>url(...)</code> statements are used. These dependencies should be resolved by the module system.</p>
<p>This can be done in one of two ways:</p>
<ul>
<li>By transforming them to <code>require</code> statements.</li>
<li>Using the <code>this.resolve</code> function to resolve the path.</li>
</ul>
<p>The <code>css-loader</code> is a good example of the first approach. It transforms dependencies to <code>require</code>s, by replacing <code>@import</code> statements with a <code>require</code> to the other stylesheet and <code>url(...)</code> with a <code>require</code> to the referenced file.</p>
<p>In the case of the <code>less-loader</code>, it cannot transform each <code>@import</code> to a <code>require</code> because all <code>.less</code> files must be compiled in one pass for variables and mixin tracking. Therefore, the <code>less-loader</code> extends the less compiler with custom path resolving logic. It then takes advantage of the second approach, <code>this.resolve</code>, to resolve the dependency through webpack.</p>
<p>T&gt; If the language only accepts relative urls (e.g. <code>url(file)</code> always refers to <code>./file</code>), you can use the <code>~</code> convention to specify references to installed modules (e.g. those in <code>node_modules</code>). So, in the case of <code>url</code>, that would look something like <code>url('~some-library/image.jpg')</code>.</p>
<h3 id="common-code">Common Code<a class="headerlink" href="#common-code" title="Permanent link">&para;</a></h3>
<p>Avoid generating common code in every module the loader processes. Instead, create a runtime file in the loader and generate a <code>require</code> to that shared module.</p>
<h3 id="absolute-paths">Absolute Paths<a class="headerlink" href="#absolute-paths" title="Permanent link">&para;</a></h3>
<p>Don't insert absolute paths into the module code as they break hashing when the root for the project is moved. There's a <a href="https://github.com/webpack/loader-utils#stringifyrequest"><code>stringifyRequest</code></a> method in <code>loader-utils</code> which can be used to convert an absolute path to a relative one.</p>
<h3 id="peer-dependencies">Peer Dependencies<a class="headerlink" href="#peer-dependencies" title="Permanent link">&para;</a></h3>
<p>If the loader you're working on is a simple wrapper around another package, then you should include the package as a <code>peerDependency</code>. This approach allows the application's developer to specify the exact version in the <code>package.json</code> if desired.</p>
<p>For instance, the <code>sass-loader</code> <a href="https://github.com/webpack-contrib/sass-loader/blob/master/package.json">specifies <code>node-sass</code></a> as peer dependency like so:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;peerDependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;node-sass&quot;</span><span class="p">:</span> <span class="s2">&quot;^4.0.0&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<p>So you've written a loader, followed the guidelines above, and have it set up to run locally. What's next? Let's go through a simple unit testing example to ensure our loader is working the way we expect. We'll be using the <a href="https://jestjs.io/">Jest</a> framework to do this. We'll also install <code>babel-jest</code> and some presets that will allow us to use the <code>import</code> / <code>export</code> and <code>async</code> / <code>await</code>. Let's start by installing and saving these as a <code>devDependencies</code>:</p>
<div class="codehilite"><pre><span></span>npm install --save-dev jest babel-jest babel-preset-env
</pre></div>

<p><strong>.babelrc</strong></p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;presets&quot;</span><span class="p">:</span> <span class="p">[[</span>
    <span class="s2">&quot;env&quot;</span><span class="p">,</span>
    <span class="p">{</span>
      <span class="nt">&quot;targets&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;node&quot;</span><span class="p">:</span> <span class="s2">&quot;4&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]]</span>
<span class="p">}</span>
</pre></div>

<p>Our loader will process <code>.txt</code> files and simply replace any instance of <code>[name]</code> with the <code>name</code> option given to the loader. Then it will output a valid JavaScript module containing the text as it's default export:</p>
<p><strong>src/loader.js</strong></p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">getOptions</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;loader-utils&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">loader</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">getOptions</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="nx">source</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\[name\]/g</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

  <span class="k">return</span> <span class="sb">`export default </span><span class="si">${</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>We'll use this loader to process the following file:</p>
<p><strong>test/example.txt</strong></p>
<div class="codehilite"><pre><span></span>Hey <span class="o">[</span>name<span class="o">]</span>!
</pre></div>

<p>Pay close attention to this next step as we'll be using the <a href="/api/node">Node.js API</a> and <a href="https://github.com/webpack/memory-fs"><code>memory-fs</code></a> to execute webpack. This lets us avoid emitting <code>output</code> to disk and will give us access to the <code>stats</code> data which we can use to grab our transformed module:</p>
<div class="codehilite"><pre><span></span>npm install --save-dev webpack memory-fs
</pre></div>

<p><strong>test/compiler.js</strong></p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">path</span> <span class="nx">from</span> <span class="s1">&#39;path&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">webpack</span> <span class="nx">from</span> <span class="s1">&#39;webpack&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">memoryfs</span> <span class="nx">from</span> <span class="s1">&#39;memory-fs&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">(</span><span class="nx">fixture</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">compiler</span> <span class="o">=</span> <span class="nx">webpack</span><span class="p">({</span>
    <span class="nx">context</span><span class="o">:</span> <span class="nx">__dirname</span><span class="p">,</span>
    <span class="nx">entry</span><span class="o">:</span> <span class="sb">`./</span><span class="si">${</span><span class="nx">fixture</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
    <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">),</span>
      <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;bundle.js&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">rules</span><span class="o">:</span> <span class="p">[{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.txt$/</span><span class="p">,</span>
        <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">loader</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../src/loader.js&#39;</span><span class="p">),</span>
          <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Alice&#39;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}]</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">compiler</span><span class="p">.</span><span class="nx">outputFileSystem</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">memoryfs</span><span class="p">();</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">compiler</span><span class="p">.</span><span class="nx">run</span><span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stats</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">hasErrors</span><span class="p">())</span> <span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">toJson</span><span class="p">().</span><span class="nx">errors</span><span class="p">));</span>

      <span class="nx">resolve</span><span class="p">(</span><span class="nx">stats</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>
</pre></div>

<p>T&gt; In this case, we've inlined our webpack configuration but you can also accept a configuration as a parameter to the exported function. This would allow you to test multiple setups using the same compiler module.</p>
<p>And now, finally, we can write our test and add an npm script to run it:</p>
<p><strong>test/loader.test.js</strong></p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">compiler</span> <span class="nx">from</span> <span class="s1">&#39;./compiler.js&#39;</span><span class="p">;</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;Inserts name and outputs JavaScript&#39;</span><span class="p">,</span> <span class="nx">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">stats</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">compiler</span><span class="p">(</span><span class="s1">&#39;example.txt&#39;</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">toJson</span><span class="p">().</span><span class="nx">modules</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">source</span><span class="p">;</span>

  <span class="nx">expect</span><span class="p">(</span><span class="nx">output</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;export default &quot;Hey Alice!\\n&quot;&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p><strong>package.json</strong></p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;jest&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>With everything in place, we can run it and see if our new loader passes the test:</p>
<div class="codehilite"><pre><span></span> PASS  test/loader.test.js
  ✓ Inserts name and outputs JavaScript <span class="o">(</span>229ms<span class="o">)</span>

Test Suites: <span class="m">1</span> passed, <span class="m">1</span> total
Tests:       <span class="m">1</span> passed, <span class="m">1</span> total
Snapshots:   <span class="m">0</span> total
Time:        <span class="m">1</span>.853s, estimated 2s
Ran all <span class="nb">test</span> suites.
</pre></div>

<p>It worked! At this point you should be ready to start developing, testing, and deploying your own loaders. We hope that you'll share your creations with the rest of the community!</p></article></div></div></main><footer class="md-footer"><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright">powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div></div></div></footer></div><script src="../../../assets/javascripts/application.d5a09f94.js"></script><script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script></body></html>